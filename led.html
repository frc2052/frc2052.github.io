---
layout: default
permalink: /led/
---
<div class="container mt-5">
    <h1 class="kk">LEDs the KnightKrawler Way</h1>
    <div class="row">
        <div class="col-md-12">
            <!--Overview statement card-->
            <div class="card card-kk mr-5">
                <div class="card-heading">
                    Goals
                </div>
                <div class="card-body">
                    <p>
                        After a few years of failed attempts at LEDs, include a few rounds of magic smoke and burned
                        out controllers,
                        KnightKrawler set off to create a uniform way to control LEDs. The goal was to create a
                        setup that
                        would work the same on the robot, or at a desk. We wanted a way to have several "training
                        setups" that worked identical
                        to the way it would work on the robot connected to a RoboRio. This resulted in a few
                        concrete design guidelines.
                    </p>

                    <p>
                        <strong>WS2812b LEDs</strong><br />
                        We decided to standardize on WS2812b LEDs. These LEDs are 5 volts and low power consuption.
                        More importantly, they are low cost and easy to find.
                        This type of LEDs also opened up the opportunity to created additional LED projects, such as
                        an LED display panel for the robot cart, or wearable LEDs for hats and vests.
                        Using 12V automotive LEDs often found on FRC robots would have made these other projects
                        more complicated or impossible. We alos decided to purchase LEDs enclosed a waterproof
                        rubber sleeve. While the waterproof part isn't necessary, the rubble sleeve protects against
                        accitental shorts and offers some protection to the strip.
                    </p>

                    <p>
                        <strong>ESP32 Co-processor</strong><br />
                        While many teams are using an Arduino for LED control. The very limitted processing power
                        and memory, coupled with price of Arduino processors was a bad combination.
                        The ESP32 chips run the same Ardunio code.
                        and there are many ESP32 platforms for under $10 which offer significantly more power and
                        memory in a much smaller package.
                    </p>

                    <p>
                        <strong>Easy and Safe Power</strong><br />
                        We wanted the co-processor to always be run from USB power. It is possible to directly power
                        a co-processor from a battery, since most chips have a VIN (Voltage In) pin.
                        While correct wiring practices will ensure that this can be done safely, there is always the
                        possibility that a cheap ESP32 manufaturuer or a mistake in wiring could send reverse
                        voltage back
                        into laptop. Your $10 LED processor could severely damage your very expensive computer. To
                        reduct this risk, we decided to ensure the ESP32 co-processor is always powered off USB.
                        This creates
                        the need for a powered USB plug. However, but adding this plug is makes a training setup
                        very simple for students to understand. They can plug the ESP32 into the computer to program
                        it, when doing so
                        the processor is powered by the laptop. Then unplugging the processor from the laptop and
                        into the USB power source on the training setup, puts the chip on the independent power
                        source. Our training
                        setup runs on a 12v robot battery. For training, a student simply grabs a robot battery,
                        sets it on the desk, and the entire system is ready to go. This also makes it possible for
                        the same setup to
                        be used for lights on the pit, robot cart, or anywhere you want to display LEDs.
                    </p>
                    <p>
                        <strong>Easy to Troubleshoot Signaling</strong><br />
                        Communicating between the RoboRio and a co-processor can be a challenge for any team,
                        especially new teams to figure out. Worse, it can become near impossible to troubleshoot
                        more complicated computer
                        protocols such as SPI or I2C if you are not an expert and choose to communicate to your
                        co-processor this way. Adding to the complexity, how do you simulate a call from the RoboRio
                        to change the light pattern if you are communicating over SPI or I2C if you don't have
                        a RoboRio? So, KnightKrawler uses a very simple approach to chaning the light pattern. We
                        use binary signals and DIO. This will be explained in detail later, but using simple HIGH or
                        LOW pin voltages,
                        (similar to a DIO sensor such as a limit switch), allows for troubleshooting with simple
                        debug statements or even a voltage meter. Each pin on the co-processor can represent a
                        binary number.
                        If pins 0,2,and 3 are being signalled, this would represent the binary number 1011 or the
                        number 13 (1 + 4 + 8) in decimal. Very few teams are using all 10 DIO pins on their Robio.
                        Having just 5 of the 10 pins
                        available means you have 2^5 (32) different light patterns you can code. Adding a screen to
                        your processor makes debugging even easier.
                    </p>
                    <p>
                        <strong>Female Pin Sockets</strong><br />
                        The diagram indicates two pin socket strips will be used. These are only necessary if you plan to create a test box (below). 
                        It is possble to use jumper wires directly from the pins on the ESP32 co-processor board directly to ground for testing. 
                        For connecting to the RoboRio, these pins can be wired direclty to the RoboRio DIO pins through a ribbon cable or jumper wires.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">

            <!--Shopping List Card-->
            <div class="card card-kk mr-5 mt-3">
                <div class="card-heading">
                    Shopping List
                </div>
                <div class="card-body">
                    <p>
                        We assume you will want at least a couple LED setups so you can have one on the robot, and
                        more for testing. Some parts are as cheap to buy in bulk as they are to buy 1. Here is the
                        list of parts we purchase.
                    </p>
                    <ul>
                        <li><a href="https://amzn.to/4aiC1El" target="_blank">ESP32 Processor</a></li>
                        <li><a href="https://amzn.to/3VQWefM" target="_blank">12v to 5v Power Converter</a></li>
                        <li><a href="https://amzn.to/49li7Hl" target="_blank">USB Charger Socket</a></li>
                        <li><a href="https://amzn.to/3J4A6Hf" target="_blank">OLED Display</a></li>
                        <li><a href="https://amzn.to/4aFKEZ4" target="_blank">Female Header Socket</a></li>
                        <li><a href="https://amzn.to/3TMJ1SG" target="_blank">Male Header Pins</a></li>
                        <li><a href="https://amzn.to/3JaGtsx" target="_blank">WS2812B Waterproof LED Strip</a></li>
                        <li><a href="https://amzn.to/3PS5Hjh" target="_blank">Lever Wire Connectors</a></li>
                        <li><a href="https://amzn.to/3vEinDy" target="_blank">Jumper Wires</a></li>
                        <li><a href="https://amzn.to/3VHD24c" target="_blank">PCB Boards (optional)</a></li>
                    </ul>
                    <p>
                        You will need wire and a connection to your robot battery. KnightKrawler uses the <a
                            href="https://www.andymark.com/products/sb-50a-app-connector-with-contacts"
                            target="_blank">Anderson connector</a> for our batteries.
                        It is wise to separate the resting setup from the battery with 
                        <a href="https://www.andymark.com/products/powerpole-kit-8-red-and-black-housings-16-contacts" target="_blank"> Anderson Powerpole connectors.</a> 
                        By doing this, it is possible to connect your testing rig directly to the PDH on the
                        robot more easily.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card card-kk mr-5 mt-3">
                <div class="card-heading">
                    Wiring
                </div>
                <div class="card-body">
                    <p class="center">
                        <img src="/assets/images/leds/ledSetup.png" width="100%" />
                    </p>
                    <p>
                        <strong>Common Ground</strong><br />
                        A common mistake in wiring and working with a co-processor is establishing a common ground. When the co-processor is connected to a laptop, it receives its 
                        positive and negavie power connection through the USB cable to the laptop. However, we cannot power the LEDs off the power that comes from the USB port.
                        There just insn't enough power, so power is supplied through the robot battery. The ESP32 processor is attempting to control the LEDs through a signal wire
                        connected to pin 2 in the diagram above. A problem is created when the co-processor is is powered from the laptop, and the LEDs are powered by the battery. 
                        There must be "common ground". Notice in the diagram that the ESP32 has a ground connection to the battery that powers the LEDs. If your LED lights flicker irradically, 
                        you are probably missing a common ground.
                    </p>
                    <p>
                        <strong>DIO Input</strong><br />
                        In the diagram. The female header sockets for DIO input is connected on pins D13, D12, D14, D27, D26, D25, D33, and D32. The pin order may seem illogical and we agree. Different manufactureres will use different
                        pin numbering. This diagram uses the Upesy Wroom DevKit linked in the shopping list. We have also used the more expensive <a href="https://amzn.to/3PJSskL" target="_blank">HiLetgo</a>
                        board with integrated screen, which has a very different pin numbering scheme. However we have noticed a delay in the screen and do recommend this co-processor if you want very quick light 
                        changes for your robot.
                    </p>
                    <p>
                        <strong>Pull-Up</strong><br />
                        There is a concept in circuitry called a "Pull-Up Resistor" or "Pull-Up Circuit". In electricity, when attempting to read a DIO signal, you really need to have a HIGH (3.3V) signal or a LOW (0V - Ground) signal.
                        This can be an abstract concept to first grasp and there a many YouTube videos explaining this. In practice with a pin is not connected to anything at all, it is "floating", which means it could read either
                        HIGH or LOW and can fluctuate depending on static in the air and a variety of other things. Pull-up circuits allow a pin to read high when nothing is connected. Nearly all boards including the RoboRio and ESP32 include
                        the ability to tell a pin to turn on the build in pull-up resister. Some boards have the option for pull-down circuits but it is less widely supported and therefore not a reliable way to write code. Unfortunately, this means
                        when we write code we have to assume with a pin reads high the cicuit is open (off) and when it reads low it is closed (on). To make this work, we have to connect the other set of femal header pins to ground. It seems 
                        backwards to the person new to electronics, so for now just trust this is the easiest way to make this system work.
                    </p>
                    <p>
                        <strong>Screens</strong><br />
                        There are many shapes, sized and styles of screens. We have choosen this screen for cost and compact size. Most screens have a simple I2C connection using the "CL" (clock) and "DA" (data) pins. It makes 
                        programming a display easy. Make sure your display is powered from the 3V output on the co-processor, not 5V pin.
                    </p>
                    <p>
                        <strong>Power</strong><br />
                        We selected a low cost 12V to 5V converter for powering the LEDs and a simple USB power socket. More robust converters are available they my tolerate brown-outs more gracefully, but we have not encoutered an issue so far.
                        The converter for the LEDs can supply up to 3 amps. If you are attempting to run multiple strips or pannels you may need a conveter that can supply more amps. 
                        On the standard LED wire harnes, white is ground (negative), green is signal, and red is power (positive).
                    </p>
                    <p>
                        <strong>Pins</strong><br />
                        Selecting pins to use in wiring your lights can vary. The diagram only shows the pins we have used for DIO input, and for signaling the LEDs (pin 2). A word of caution, veryify the input pins support "Pull-Up" mode in
                        your code before soldering anything. We found that not all pins on the Upesy Wroom kit support the pull-up feature.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="card card-kk mr-5 mt-3">
                <div class="card-heading">
                    Case
                </div>
                <div class="card-body">
                    <p class="center">
                        <img src="/assets/images/leds/caseInsides.png" width="100%" />
                    </p>
                    <p>
                        <strong>Models</strong><br />
                        Download the models from <a href="https://www.printables.com/model/831289" target="_blank">Printables.com</a>
                    </p>

                    <p class="center">
                        <img class="center" src="/assets/images/leds/caseInsides.png" width="50%" />
                    </p>
                    <p>
                        <strong>Assembly</strong><br />
                        There are two dividers that go inside the case. One snaps in to protect the solder connections on the PCB board from any power wires that could break a solder connection. The other divider is a mount 
                        for the 12v to 5v converter we recommend. Use small screws to to secure the PCB Board to the case, as well as the bottom of the case. 2mm diameter screws work well.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>


    